<!DOCTYPE html>
<html>

<head>
	<title>D3.js Lab</title>
	<meta charset="UTF-8">
	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

</head>

<body>
	<script type="text/javascript">
		// Get the JSON Data
		d3.json("https://pkgstore.datahub.io/core/co2-ppm/co2-mm-mlo_json/data/aed7eb0d19cbcd90790525d40728b0a8/co2-mm-mlo_json.json").then(function (data)
		{
			plotCO2Data(data);
		}).catch(function (error) 
		{
			console.error("Error loading data:", error);
		});

		plotCO2Data(data);

		// Executed once file has been downloaded
		function plotCO2Data(data) 
		{
			
			// Setup SVG size and margins
			var margin = { top: 80, right: 80, bottom: 80, left: 80 },
				width = 900 - margin.left - margin.right,
				height = 670 - margin.top - margin.bottom;

			var parseDate = d3.timeParse("%Y-%m-%d");

			// x scales for EUR/USD - time (x-axis)
			var x = d3.scaleTime()
				.domain(d3.extent(data, function (d) { return parseDate(d["Date"]); }))
				.range([0, width]);

			// y scales for EUR/USD - value (y-axis)
			var y = d3.scaleLinear()
				.domain(d3.extent(data, function (d) { return d["Interpolated"] }))
				.range([height, 0]);

			// Axes
			// x is the scaleTime()
			var xAxis = d3.axisBottom(x)
				.ticks(5);

			// y is the ScaleLinear
			var yAxis = d3.axisLeft(y)
				.ticks(5);

			// Draw line - maps x,y coordinates for each data point, using x,y scale functions
			var valueline = d3.line()
				.x(function (d) { return x(parseDate(d["Date"])); }) //x pixel
				.y(function (d) { return y(d["Interpolated"]); }); //y pixel

			var svg = d3.select('body')
				.append("svg")
				.attr("width", width + margin.left + margin.right)
				.attr("height", height + margin.top + margin.bottom)
				.append('g')
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			// add x axis and the line object to the SVG element
			// x axis on the bottom
			svg.append('g')
				.attr('class', 'x axis')
				.attr("transform", "translate(0," + height + ")")
				.call(xAxis)
				.selectAll("text")
				.style("text-anchor", "end")
				.style("stroke", d3.color("steelblue"))
				.attr("dx", "3em")
				.attr("dy", "-.3em")
				.attr("transform", "rotate(60)");

			// add y axis and the line object to the SVG element
			// y axis on the left					
			svg.append('g')
				.attr('class', 'y axis')
				.style("stroke", d3.color("steelblue"))
				.call(yAxis);

			// text label for the x axis	
			svg.append('text')
				.attr('x', width / 2)
				.attr('y', 40)
				.attr('text-anchor', 'middle')
				.style("stroke", d3.color("black"))
				.text(' EUR vs. USD currency data ');

			// text label for the y axis	
			svg.append("text")
				.style("text-anchor", "middle")
				.attr("y", "-2.2em")
				.attr("transform", "translate(0," + (height / 2) + ")rotate(-90)")
				.style("stroke", d3.color("black"))
				.text("EUR/USD");

			svg.append("path") // Add the valueline path
				.attr("d", valueline(data));
		}
	</script>

</body>

</html>